services:

    #
    # Elastica related services
    #
    apisearch_server.elastica_client:
        class: Elastica\Client
        arguments:
            - "%apisearch_server.cluster%"

    apisearch_server.elastica_wrapper:
        class: Apisearch\Server\Elastica\ElasticaWrapper
        arguments:
            - "@apisearch_server.elastica_client"

    #
    # Elastica repositories
    #
    apisearch_server.elastica_with_app_id_wrapper:
        class: Apisearch\Server\Elastica\ElasticaWithAppIdWrapper
        abstract: true
        public: false
        arguments:
            - "@apisearch_server.elastica_wrapper"
            - "%apisearch_server.config.repository%"

    apisearch_server.elastica_query_repository:
        class: Apisearch\Server\Elastica\Repository\QueryRepository
        parent: apisearch_server.elastica_with_app_id_wrapper
        tags:
            - {name: "apisearch_server.elastica_repository"}

    apisearch_server.elastica_index_repository:
        class: Apisearch\Server\Elastica\Repository\IndexRepository
        parent: apisearch_server.elastica_with_app_id_wrapper
        tags:
            - {name: "apisearch_server.elastica_repository"}

    apisearch_server.elastica_delete_repository:
        class: Apisearch\Server\Elastica\Repository\DeleteRepository
        parent: apisearch_server.elastica_with_app_id_wrapper
        tags:
            - {name: "apisearch_server.elastica_repository"}

    apisearch_server.elastica_config_repository:
        class: Apisearch\Server\Elastica\Repository\ConfigRepository
        parent: apisearch_server.elastica_with_app_id_wrapper
        tags:
            - {name: "apisearch_server.elastica_repository"}

    apisearch_server.elastica_event_repository:
        class: Apisearch\Server\Elastica\Repository\EventRepository
        arguments:
            - "@apisearch_server.elastica_client"
            - "%apisearch_server.config.event_repository%"


    #
    # Adapters
    #
    apisearch_server.elastica_repository:
        class: Apisearch\Server\Elastica\Repository\Repository
        arguments:
            - "@apisearch_server.elastica_query_repository"
            - "@apisearch_server.elastica_index_repository"
            - "@apisearch_server.elastica_delete_repository"

    #
    # Middlewares
    #
    apisearch_server.middleware.log_all_domain_events_to_elastica:
        class: Apisearch\Server\Elastica\Middleware\LogAllDomainEventsToElasticaMiddleware
        arguments:
            - "@apisearch_server.elastica_client"
            - "@apisearch_server.event_publisher"
        public: false

    apisearch_server.middleware.transaction:
        class: Apisearch\Server\Elastica\Middleware\TransactionElasticaMiddleware
        arguments:
            - "@apisearch.repository_search.default"